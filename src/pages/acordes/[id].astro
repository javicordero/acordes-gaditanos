---
import { getCollection, render } from 'astro:content';
import AcordeCard from '../../components/acorde-card.astro';
import Header from '../../components/header.astro';
import Layout from '../../layouts/Layout.astro';
import Footer from '../../components/footer.astro';
import YoutubeCard from '../../components/right-column/youtube-card.astro';
import SitiosDeInteresCard from '../../components/right-column/sitios-de-interes-card.astro';
import Apoyar from '../../components/right-column/apoyar.astro';
import ApareceAqui from '../../components/right-column/aparece-aqui.astro';

export async function getStaticPaths() {
  const acordes = await getCollection('acordes');
  return acordes.map((acorde: { slug: any }) => ({
    params: { id: acorde.slug },
    props: { acorde },
  }));
}

const { acorde } = Astro.props;
const { data, slug } = acorde;
const { pieza, agrupacion, musica, img, year, letra, video, cover } = data;
---

<Layout title={`${pieza} - ${agrupacion}`} description={`Acordes ${pieza} ${musica}`}>
  <Header />

  <main class='main-container container-layout'>
    <AcordeCard acorde={acorde} />

    <div class='right-column'>
      <YoutubeCard link={video} />

      {cover && <YoutubeCard link={cover} title='Cover de Juan' />}
      {!cover && <ApareceAqui />}

      <Apoyar />

      <SitiosDeInteresCard />
    </div>
  </main>

  <Footer />
</Layout>

<style>
  main {
    display: flex;
    row-gap: 16px;
    column-gap: 32px;
  }

  .right-column {
    display: flex;
    flex-direction: column;
    gap: 16px;
    /* La columna derecha crecerá para rellenar el espacio restante dentro del contenedor hasta un máximo razonable */
    flex: 1 1 clamp(220px, 22vw, 380px);
    min-width: 0;
  }

  /* Mantener la card izquierda con su anchura natural (el componente controla su propio max-width)
     y dejar que la columna derecha tome el espacio sobrante */
  main > .acordes-container {
    flex: 0 0 auto;
    min-width: 0;
  }

  @media (max-width: 780px) {
    main {
      column-gap: 16px;
    }
  }

  /* Para resoluciones intermedias (tablet → pequeño desktop) hacemos la card más estrecha */
  @media (min-width: 640px) and (max-width: 1024px) {
    main > .acordes-container {
      /* Reducir anchura y fijar base para que no ocupe tanto espacio */
      max-width: 576px;
      min-width: 0;
    }
  }

  @media (max-width: 640px) {
    main {
      flex-direction: column;
    }
  }

  @media (min-width: 900px) {
    .right-column {
      flex: 1 1 clamp(260px, 20vw, 480px);
    }
  }
</style>
