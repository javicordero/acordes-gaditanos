---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import CardsGroup from '../components/CardsGroup.astro';
import YearsList from '../components/YearsList.astro';
import AutorCardsGroup from '../components/AutorCardsGroup.astro';
import CookieBanner from '../components/adsense/CookieBanner.astro';

function parseSpanishDate(str: string) {
  const [d, m, y] = str.split(/[-/]/).map(Number);
  return new Date(y, m - 1, d); // Date(year, monthIndex, day)
}

let acordes = await getCollection('acordes');

acordes = acordes.sort((a, b) => {
  const yearA = a.data.year;
  const yearB = b.data.year;
  if (yearA !== yearB) {
    return yearB - yearA;
  }
  const dateA = parseSpanishDate(a.data.date);
  const dateB = parseSpanishDate(b.data.date);
  return dateB.getTime() - dateA.getTime();
});

const destacadas = acordes
  .filter((acorde) => acorde.data.destacada === true || acorde.data.destacada === 'true')
  .sort((a, b) => {
    const dateA = parseSpanishDate(a.data.date);
    const dateB = parseSpanishDate(b.data.date);
    return dateB.getTime() - dateA.getTime();
  });

let autores = await getCollection('autores');
---

<Layout
  title='Acordes Gaditanos - Acordes y Letras del Carnaval de Cádiz'
  description='La mayor colección de acordes y letras del Carnaval de Cádiz. Encuentra acordes de chirigotas, comparsas, cuartetos y coros para tocar con tu guitarra.'>
  <div class='main-container container-layout'>
    <CardsGroup year={'DESTACANDO'} acordes={destacadas} />
    <AutorCardsGroup autores={autores} />
    <YearsList
      years={Array.from(new Set(acordes.map((acorde) => acorde.data.year))).sort((a, b) => b - a)}
    />
  </div>
</Layout>

<style>
  .main-container {
    display: flex;
    flex-direction: column;
    gap: var(--main-container-gap);
  }

  @media (max-width: 640px) {
    .main-container {
      gap: calc(var(--main-container-gap-sm) - 16px);
    }
  }
</style>
