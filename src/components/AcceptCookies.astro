---
/**
 * AcceptCookies.astro — Banner GDPR para consentimiento
 * Funciona 100% en cliente y con sitios estáticos.
 * Activa Google Analytics solo cuando cookiesAccepted=true
 */
---

<aside
  id='accept-cookies-banner'
  class='accept-cookies'
  role='dialog'
  aria-modal='true'
  aria-labelledby='accept-cookies-title'
  style='display:none'>
  <div class='accept-cookies__inner'>
    <h2 id='accept-cookies-title'>Este sitio usa cookies</h2>
    <p>
      Utilizamos cookies para mejorar tu experiencia y analizar el tráfico. Puedes aceptar o
      rechazar el uso de cookies analíticas.
    </p>

    <div class='accept-cookies__actions'>
      <button class='btn btn--primary' data-accept-cookies> Aceptar </button>
      <button class='btn' data-reject-cookies> Rechazar </button>
    </div>
  </div>
</aside>

<script is:inline>
  (function () {
    const banner = document.getElementById('accept-cookies-banner');
    if (!banner) return;

    // ✅ Si ya existe la cookie => NO mostrar banner
    if (document.cookie.includes('cookiesAccepted=true')) {
      banner.style.display = 'none';
      return;
    }

    // ✅ Mostrar banner porque no hay consentimiento aún
    banner.style.display = 'flex';

    // ✅ Botón aceptar
    const acceptBtn = banner.querySelector('[data-accept-cookies]');
    if (acceptBtn) {
      acceptBtn.addEventListener('click', () => {
        // Guardar cookie por 1 año
        document.cookie = `cookiesAccepted=true; path=/; max-age=31536000`;

        // Ocultar banner inmediatamente
        banner.style.display = 'none';

        // Recargar para que GA se cargue ahora mismo
        window.location.reload();
      });
    }

    // ✅ Botón rechazar
    const rejectBtn = banner.querySelector('[data-reject-cookies]');
    if (rejectBtn) {
      rejectBtn.addEventListener('click', () => {
        // No guardamos cookie = consentimiento NO otorgado
        banner.style.display = 'none';
      });
    }
  })();
</script>

<style>
  .accept-cookies {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--primary-bg, #fff);
    box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.08);
    z-index: 1000;
    padding: 1.5rem 1rem;
    display: flex;
    justify-content: center;
  }
  .accept-cookies__inner {
    max-width: 480px;
    width: 100%;
    text-align: center;
  }
  .accept-cookies__actions {
    margin-top: 1rem;
    display: flex;
    gap: 1rem;
    justify-content: center;
  }
</style>
